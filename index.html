<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Star of Ash — Card/Text Builder</title>
<style>
  :root{
    --bg:#0b0d0f; --panel:#14181c; --panel2:#1b2026;
    --ink:#e6edf3; --muted:#9aa7b2; --accent:#6aa9ff;
    --ok:#33c48f; --warn:#ffb454; --err:#ff6b6b;
    --border:#28313a; --card-w:300px; --card-h:420px;
    --radius:16px;
  }
  body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--ink)}
  header{padding:12px 16px;background:#111;border-bottom:1px solid var(--border)}
  header h1{margin:0;font-size:18px}
  main{display:grid;grid-template-columns:380px 1fr;gap:16px;padding:16px}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:12px}
  .form{padding:14px;display:flex;flex-direction:column;gap:12px}
  .section{padding-bottom:12px;border-bottom:1px dashed var(--border)}
  .section:last-child{border-bottom:0}
  label{font-size:13px;display:block;margin:6px 0 3px}
  input,select,textarea{width:100%;padding:8px;border-radius:8px;
    border:1px solid var(--border);background:var(--panel2);color:var(--ink)}
  textarea{min-height:60px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
  button{padding:8px 12px;border-radius:8px;border:1px solid var(--border);cursor:pointer}
  button.primary{background:var(--accent);color:#000}
  .status{font-size:12px;padding:8px;color:var(--muted)}
</style>
</head>
<body>
<header><h1>⭐ Star of Ash — Card/Text Builder</h1></header>

<main>
  <!-- Left Panel -->
  <aside class="panel form">
    <div class="section">
      <h3>Card Info</h3>
      <label>Name</label><input id="name" type="text" />
      <div class="row">
        <div><label>Faction</label>
          <select id="faction"><option>Flame</option><option>Blood</option><option>Ash</option></select></div>
        <div><label>Type</label>
          <select id="ctype"><option>Creature</option><option>Relic</option><option>Sorcery</option></select></div>
      </div>
      <div class="row3">
        <div><label>Cost</label><input id="cost" type="number" value="1"></div>
        <div><label>ATK</label><input id="atk" type="number" value="1"></div>
        <div><label>HP</label><input id="hp" type="number" value="1"></div>
      </div>
      <label>Mechanics</label><input id="mechanics" type="text">
      <label>Rules</label><textarea id="rules"></textarea>
      <label>Flavor</label><textarea id="flavor"></textarea>
      <label>Rarity</label>
      <select id="rarity"><option>Common</option><option>Uncommon</option><option>Rare</option><option>Legendary</option></select>
      <label>Art URL</label><input id="artUrl" type="text">
    </div>

    <div class="section">
      <h3>CSV Import</h3>
      <input id="csvFile" type="file" accept=".csv" />
      <small>Headers: name,faction,ctype,cost,atk,hp,mechanics,rules,flavor,rarity,artUrl</small>
    </div>

    <div class="section">
      <h3>Controls</h3>
      <button id="btnRender" class="primary">Render Preview</button>
      <button id="btnAdd">Add to Sheet</button>
      <button id="btnClear">Clear Sheet</button>
      <button id="btnSaveOne">Download Card</button>
      <button id="btnSaveSheet">Download Sheet</button>
    </div>
    <div class="status" id="status">Ready.</div>
  </aside>

  <!-- Right Panel -->
  <section class="panel" style="padding:12px">
    <h3>Preview</h3>
    <canvas id="single" width="300" height="420"></canvas>
    <h3>Sheet</h3>
    <canvas id="sheet" width="1000" height="800"></canvas>
  </section>
</main>

<script>
// helpers
const $ = id=>document.getElementById(id);
const single=$("single"), sheet=$("sheet"), status=$("status");
let sheetCards=[];

function collectCard(){
  return {
    name: $("name").value||"Unnamed",
    faction:$("faction").value,
    ctype:$("ctype").value,
    cost:parseInt($("cost").value)||0,
    atk:parseInt($("atk").value)||0,
    hp:parseInt($("hp").value)||0,
    mechanics:$("mechanics").value,
    rules:$("rules").value,
    flavor:$("flavor").value,
    rarity:$("rarity").value,
    artUrl:$("artUrl").value
  };
}

// simple draw
function drawCard(ctx,card){
  ctx.fillStyle="#222";ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height);
  ctx.fillStyle="#fff";ctx.font="16px sans-serif";
  ctx.fillText(card.name,10,20);
  ctx.fillText(card.faction+" "+card.ctype+" Cost:"+card.cost,10,40);
  ctx.fillText("ATK:"+card.atk+" HP:"+card.hp,10,60);
  ctx.fillText(card.mechanics,10,90);
  ctx.fillText(card.rules,10,120);
  ctx.fillText(card.flavor,10,180);
}

function renderSingle(){
  const card=collectCard();
  drawCard(single.getContext("2d"),card);
  status.textContent="Preview updated.";
}
function addToSheet(){
  sheetCards.push(collectCard());
  renderSheet();
}
function renderSheet(){
  const ctx=sheet.getContext("2d");
  ctx.clearRect(0,0,sheet.width,sheet.height);
  let x=10,y=20;
  sheetCards.forEach((c,i)=>{
    drawCard(ctx,c);
    ctx.translate(0,150);
  });
  status.textContent="Sheet rendered with "+sheetCards.length+" cards.";
}
function clearSheet(){sheetCards=[];renderSheet();status.textContent="Cleared."}
function saveCanvasPNG(cnv,name){
  const a=document.createElement("a");
  a.download=name;a.href=cnv.toDataURL();a.click();
}

// CSV upload
$("csvFile").addEventListener("change", e=>{
  const file=e.target.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=()=>{
    const rows=reader.result.trim().split(/\r?\n/).map(r=>r.split(","));
    const headers=rows.shift().map(h=>h.trim());
    rows.forEach(r=>{
      let c={};headers.forEach((h,i)=>c[h]=r[i]);
      c.cost=parseInt(c.cost)||0;c.atk=parseInt(c.atk)||0;c.hp=parseInt(c.hp)||0;
      sheetCards.push(c);
    });
    renderSheet();
    status.textContent="Imported "+rows.length+" cards from CSV.";
  };
  reader.readAsText(file);
});

// buttons
$("btnRender").onclick=renderSingle;
$("btnAdd").onclick=addToSheet;
$("btnClear").onclick=clearSheet;
$("btnSaveOne").onclick=()=>saveCanvasPNG(single,"card.png");
$("btnSaveSheet").onclick=()=>saveCanvasPNG(sheet,"sheet.png");

// init
renderSingle();
</script>
</body>
</html>
